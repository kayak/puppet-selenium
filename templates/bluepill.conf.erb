require 'yaml'

cfg = YAML.load <<CONFIG
appname: <%= @appname %>
user: <%= scope.lookupvar('conf::user_name') %>
group: <%= scope.lookupvar('conf::user_group') %>
pidfile: <%= @pidfile %>
logfile: <%= @logfile %>
CONFIG

start_command = <<CMD
<%= @cmd %>
CMD

Bluepill.application(cfg['appname']) do |app|
  app.uid = cfg['user']
  app.gid = cfg['group']
  app.process(cfg['appname']) do |process|
    process.start_command = start_command.chomp
    process.daemonize = true
    process.pid_file = File.join(cfg['pidfile'])
    process.stdout = process.stderr = cfg['logfile']
  end
end
