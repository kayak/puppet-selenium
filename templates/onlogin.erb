#!/bin/bash

<% require 'base64' -%>

set -e

exec ><%= File.join(@logdir,'onlogin.log') %> 2>&1

date
echo "Enabling VNC server"

gsettings set org.gnome.Vino enabled true
gsettings set org.gnome.Vino prompt-enabled false

schema="/desktop/gnome/remote_access"
gconftool-2 -s $schema/icon_visibility -t string never
gconftool-2 -s $schema/enabled -t bool true
gconftool-2 -s $schema/prompt_enabled -t bool false

gconftool-2 -s $schema/vnc_password -t string never
gconftool-2 -s $schema/authentication_methods -t list --list-type string '[none]'

<% if @disable_screen_lock -%>

echo "Disabling screen lock"

gsettings set org.gnome.desktop.screensaver lock-enabled false
gsettings set org.gnome.desktop.screensaver idle-activation-enabled false

<% else -%>

echo "Not disabling screen lock"

<% end -%>

echo "VNC setup finished"
